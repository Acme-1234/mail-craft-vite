<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Blocks Test</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            overflow: hidden; 
        }
        .header { 
            background: #2563eb; 
            color: white; 
            padding: 20px; 
        }
        .controls { 
            padding: 20px; 
            border-bottom: 1px solid #e5e7eb; 
            background: #f9fafb; 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
        }
        .btn { 
            background: #2563eb; 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 6px; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: 500;
            transition: background-color 0.2s;
        }
        .btn:hover { 
            background: #1d4ed8; 
        }
        .btn-success { 
            background: #059669; 
        }
        .btn-success:hover { 
            background: #047857; 
        }
        .btn-secondary { 
            background: #6b7280; 
        }
        .btn-secondary:hover { 
            background: #4b5563; 
        }
        iframe { 
            width: 100%; 
            height: 700px; 
            border: none; 
        }
        .block-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ New Blocks Test</h1>
            <p>Test the newly added block types: Heading, Avatar, Divider, Spacer, and HTML blocks.</p>
        </div>
        
        <div class="controls">
            <div class="block-grid">
                <button class="btn btn-success" onclick="addHeadingBlock()">‚ûï Add Heading</button>
                <button class="btn btn-success" onclick="addAvatarBlock()">üë§ Add Avatar</button>
                <button class="btn btn-success" onclick="addDividerBlock()">‚ûñ Add Divider</button>
                <button class="btn btn-success" onclick="addSpacerBlock()">üìè Add Spacer</button>
                <button class="btn btn-success" onclick="addHtmlBlock()">üîß Add HTML</button>
                <button class="btn" onclick="addCompleteExample()">‚ú® Complete Example</button>
                <button class="btn btn-secondary" onclick="clearAll()">üóëÔ∏è Clear All</button>
                <button class="btn btn-secondary" onclick="exportHtml()">üìÑ Export HTML</button>
            </div>
        </div>
        
        <iframe src="/" id="editor-iframe"></iframe>
    </div>

    <script>
        function getIframe() {
            return document.getElementById('editor-iframe');
        }

        function waitForEditor() {
            return new Promise((resolve) => {
                const iframe = getIframe();
                const checkEditor = () => {
                    if (iframe.contentWindow.editor) {
                        resolve(iframe.contentWindow.editor);
                    } else {
                        setTimeout(checkEditor, 100);
                    }
                };
                checkEditor();
            });
        }

        async function addHeadingBlock() {
            const editor = await waitForEditor();
            
            // Create a sample document with heading
            const sampleDoc = {
                rows: [
                    {
                        id: 'row-1',
                        columns: [
                            {
                                id: 'col-1',
                                span: 12,
                                blocks: [
                                    {
                                        id: 'heading-1',
                                        type: 'heading',
                                        content: 'Welcome to Our Newsletter!',
                                        level: 1,
                                        align: 'center',
                                        styles: {
                                            color: '#2563eb',
                                            padding: '20px',
                                            backgroundColor: '#f0f9ff'
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                ]
            };
            
            editor.setJson(sampleDoc);
            console.log('Added heading block!');
        }

        async function addAvatarBlock() {
            const editor = await waitForEditor();
            
            const sampleDoc = {
                rows: [
                    {
                        id: 'row-1',
                        columns: [
                            {
                                id: 'col-1',
                                span: 12,
                                blocks: [
                                    {
                                        id: 'avatar-1',
                                        type: 'avatar',
                                        src: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face',
                                        alt: 'John Doe - CEO',
                                        size: 'large',
                                        shape: 'circle',
                                        align: 'center',
                                        styles: {
                                            padding: '20px',
                                            backgroundColor: '#f9fafb'
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                ]
            };
            
            editor.setJson(sampleDoc);
            console.log('Added avatar block!');
        }

        async function addDividerBlock() {
            const editor = await waitForEditor();
            
            const sampleDoc = {
                rows: [
                    {
                        id: 'row-1',
                        columns: [
                            {
                                id: 'col-1',
                                span: 12,
                                blocks: [
                                    {
                                        id: 'divider-1',
                                        type: 'divider',
                                        thickness: '2px',
                                        color: '#3b82f6',
                                        style: 'solid',
                                        width: '80%',
                                        align: 'center',
                                        styles: {
                                            padding: '20px'
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                ]
            };
            
            editor.setJson(sampleDoc);
            console.log('Added divider block!');
        }

        async function addSpacerBlock() {
            const editor = await waitForEditor();
            
            const sampleDoc = {
                rows: [
                    {
                        id: 'row-1',
                        columns: [
                            {
                                id: 'col-1',
                                span: 12,
                                blocks: [
                                    {
                                        id: 'spacer-1',
                                        type: 'spacer',
                                        height: '40px',
                                        styles: {}
                                    }
                                ]
                            }
                        ]
                    }
                ]
            };
            
            editor.setJson(sampleDoc);
            console.log('Added spacer block!');
        }

        async function addHtmlBlock() {
            const editor = await waitForEditor();
            
            const sampleDoc = {
                rows: [
                    {
                        id: 'row-1',
                        columns: [
                            {
                                id: 'col-1',
                                span: 12,
                                blocks: [
                                    {
                                        id: 'html-1',
                                        type: 'html',
                                        content: `
                                            <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px;">
                                                <h3 style="margin: 0 0 10px 0;">Custom HTML Block</h3>
                                                <p style="margin: 0; opacity: 0.9;">This is a custom HTML content with gradient background!</p>
                                                <div style="margin-top: 15px;">
                                                    <span style="background: rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 15px; font-size: 12px;">‚ú® HTML Powered</span>
                                                </div>
                                            </div>
                                        `,
                                        styles: {
                                            padding: '15px'
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                ]
            };
            
            editor.setJson(sampleDoc);
            console.log('Added HTML block!');
        }

        async function addCompleteExample() {
            const editor = await waitForEditor();
            
            const completeDoc = {
                rows: [
                    {
                        id: 'row-1',
                        columns: [
                            {
                                id: 'col-1',
                                span: 12,
                                blocks: [
                                    {
                                        id: 'heading-1',
                                        type: 'heading',
                                        content: 'üéâ Welcome to Our Newsletter!',
                                        level: 1,
                                        align: 'center',
                                        styles: {
                                            color: '#1f2937',
                                            padding: '30px 20px 10px 20px',
                                            fontFamily: "'Georgia', serif"
                                        }
                                    },
                                    {
                                        id: 'divider-1',
                                        type: 'divider',
                                        thickness: '1px',
                                        color: '#e5e7eb',
                                        style: 'solid',
                                        width: '60%',
                                        align: 'center',
                                        styles: {
                                            padding: '0 20px'
                                        }
                                    },
                                    {
                                        id: 'spacer-1',
                                        type: 'spacer',
                                        height: '20px'
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        id: 'row-2',
                        columns: [
                            {
                                id: 'col-2',
                                span: 4,
                                blocks: [
                                    {
                                        id: 'avatar-1',
                                        type: 'avatar',
                                        src: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=120&h=120&fit=crop&crop=face',
                                        alt: 'John Doe - CEO',
                                        size: 'large',
                                        shape: 'circle',
                                        align: 'center',
                                        styles: {
                                            padding: '20px'
                                        }
                                    }
                                ]
                            },
                            {
                                id: 'col-3',
                                span: 8,
                                blocks: [
                                    {
                                        id: 'heading-2',
                                        type: 'heading',
                                        content: 'Meet Our CEO',
                                        level: 3,
                                        align: 'left',
                                        styles: {
                                            color: '#374151',
                                            padding: '20px 20px 10px 0'
                                        }
                                    },
                                    {
                                        id: 'text-1',
                                        type: 'text',
                                        content: '<p>John has been leading our company with passion and innovation for over 10 years. His vision drives our commitment to excellence.</p>'
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        id: 'row-3',
                        columns: [
                            {
                                id: 'col-4',
                                span: 12,
                                blocks: [
                                    {
                                        id: 'spacer-2',
                                        type: 'spacer',
                                        height: '30px'
                                    },
                                    {
                                        id: 'html-1',
                                        type: 'html',
                                        content: `
                                            <div style="text-align: center; padding: 25px; background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); color: white; border-radius: 12px; margin: 0 20px;">
                                                <h3 style="margin: 0 0 15px 0; font-size: 24px;">üöÄ Ready to Get Started?</h3>
                                                <p style="margin: 0 0 20px 0; opacity: 0.9; font-size: 16px;">Join thousands of satisfied customers today!</p>
                                                <a href="#" style="display: inline-block; background: white; color: #3b82f6; padding: 12px 30px; border-radius: 25px; text-decoration: none; font-weight: bold; font-size: 16px; transition: transform 0.2s;">
                                                    Sign Up Now ‚Üí
                                                </a>
                                            </div>
                                        `,
                                        styles: {
                                            padding: '20px 0'
                                        }
                                    },
                                    {
                                        id: 'spacer-3',
                                        type: 'spacer',
                                        height: '20px'
                                    },
                                    {
                                        id: 'divider-2',
                                        type: 'divider',
                                        thickness: '1px',
                                        color: '#d1d5db',
                                        style: 'dashed',
                                        width: '100%',
                                        align: 'center',
                                        styles: {
                                            padding: '10px 20px'
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                ]
            };
            
            editor.setJson(completeDoc);
            console.log('Added complete example with all new blocks!');
        }

        async function clearAll() {
            const editor = await waitForEditor();
            editor.clearDocument();
            console.log('Cleared all content!');
        }

        async function exportHtml() {
            const editor = await waitForEditor();
            const html = editor.getHtml();
            
            // Create a new window to show the exported HTML
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <html>
                    <head>
                        <title>Exported Email</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            .preview { border: 1px solid #ddd; padding: 20px; border-radius: 8px; }
                            .code { background: #f5f5f5; padding: 15px; border-radius: 4px; margin-top: 20px; overflow: auto; }
                            pre { margin: 0; white-space: pre-wrap; word-wrap: break-word; }
                        </style>
                    </head>
                    <body>
                        <h1>Exported Email Preview</h1>
                        <div class="preview">
                            ${html}
                        </div>
                        <h2>HTML Code</h2>
                        <div class="code">
                            <pre>${html.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>
                        </div>
                    </body>
                </html>
            `);
            newWindow.document.close();
            
            console.log('Exported HTML:', html);
        }

        // Listen for editor ready
        window.addEventListener('message', (event) => {
            if (event.data.type === 'EDITOR_READY') {
                console.log('Editor is ready for new blocks testing!');
            }
        });

        // Auto-test message
        setTimeout(() => {
            console.log('üì¶ New Blocks Test Page Ready!');
            console.log('Available blocks: Heading, Avatar, Divider, Spacer, HTML');
            console.log('Try the buttons above to test each block type!');
        }, 1000);
    </script>
</body>
</html>
